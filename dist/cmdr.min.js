!function(a){a(["jquery"],function(a){function b(){if(!J){A=a(K).appendTo("body"),B=a(".input",A),C=a(".prefix",A),D=a(".prompt",A),E=a(".output",A),a(document).on("keypress.cmdr",function(b){e()||a(b.target).is("input, textarea, select")||!w(b,O.openKey)?e()&&w(b,O.closeKey)&&g():(b.preventDefault(),f())}),D.on("keydown",function(a){if(G){if(G.readLine&&13===a.keyCode)return G.readLine.resolve(D.val()),!1}else switch(a.keyCode){case 13:var b=D.val();return b&&m(b),!1;case 38:return s(),!1;case 40:return t(),!1;case 9:return!1}return!0}),D.on("keypress",function(a){if(G&&G.read){if(0===a.charCode)return!1;if(G.read["char"]=String.fromCharCode(a.charCode),G.read.capture)return!1}return!0}),D.on("keyup",function(){G&&G.read&&G.read["char"]&&G.read.resolve(G.read["char"])}),D.on("paste",function(){setTimeout(function(){var a=D.val(),b=a.split(/\r\n|\r|\n/g),c=b.length;if(c>1){for(var d=1;c>d;d++)b[d].length>0&&L.push(b[d]);G&&G.readLine?G.readLine.resolve(b[0]):G&&G.read?G.read.resolve(b[0][0]):m(b[0])}},0)}),D.on("change cut paste drop keydown",function(){setTimeout(function(){D.height("auto").height(D[0].scrollHeight)},0)});var b;a(window).on("resize.cmdr",function(){clearTimeout(b),b=setTimeout(function(){D.height("auto").height(D[0].scrollHeight)},100)}),A.on("click",function(b){a(b.target).is(".input *, .output *")||D.focus()}),o(),J=!0,O.autoOpen&&f()}}function c(){J&&(A.remove(),A=null,B=null,C=null,D=null,E=null,a(document).off("keypress.cmdr"),a(window).off("resize.cmdr"),J=!1)}function d(){J&&c(),b()}function e(){return A.is(":visible")}function f(){J&&(A.show(),setTimeout(function(){D.css("text-indent",x()+"px").focus()},0))}function g(){J&&(A.hide(),D.blur())}function h(b,c){J&&G&&(o(!0),G.read=a.Deferred().done(function(a){G.read=null,c||D.val(a),p(),b.call(G,a)===!0?h(b,c):q()}),G.read.capture=c,L.length>0&&G.read.resolve(L.shift()[0]))}function i(b){J&&G&&(o(!0),G.readLine=a.Deferred().done(function(a){G.readLine=null,D.val(a),p(),q(),b.call(G,a)===!0&&i(b)}),L.length>0&&G.readLine.resolve(L.shift()))}function j(b,c){if(J){b=b||"";var d=a("<span/>").addClass(c).text(b);F||(F=a("<div/>").appendTo(E)),F.append(d)}}function k(a,b){J&&(a=(a||"")+"\n",j(a,b),F=null)}function l(){J&&E.html("")}function m(b){if(J){if(G)return void L.push(b);if("string"!=typeof b||0===b.length)throw"Invalid command";D.val(b),q(!O.echo),r(b),p(),b=b.trim();var c=u(b),d=I[c.name.toUpperCase()];if(!d)return k("Invalid command","error"),void o();G={command:b,definition:d};var e=c.args;d.parse||(e=[c.arg]);var f=d.callback.apply(G,e);a.when(f).done(function(){setTimeout(function(){G=null,o(),L.length>0&&m(L.shift())},0)})}}function n(a,b,c){var d=v(a,b,c);I[d.name]=d}function o(a){a?F&&(C.text(F.text()),F.remove(),F=null):C.text(O.promptPrefix),B.show(),setTimeout(function(){D.prop("disabled",!1).css("text-indent",x()+"px").focus()},0)}function p(){D.prop("disabled",!0),B.hide()}function q(a){a||(j(C.text()),k(D.val())),C.text(""),D.val("")}function r(a){M.unshift(a),N=-1}function s(){M.length>N+1&&(N++,D.val(M[N]).change())}function t(){N>0&&(N--,D.val(M[N]).change())}function u(a){var b=/[^\s"]+|"([^"]*)"/gi,c=null,d=null,e=[],f=null;do if(f=b.exec(a),null!==f){var g=f[1]?f[1]:f[0];0===f.index?(c=g,d=a.substr(g.length+(f[1]?3:1))):e.push(g)}while(null!==f);return{name:c,arg:d,args:e}}function v(b,c,d){"string"!=typeof b&&(d=c,c=b,b=null),"function"!=typeof c&&(d=c,c=null);var e={name:b,callback:c,parse:!0};if(a.extend(e,d),"string"!=typeof e.name||"function"!=typeof e.callback)throw"Invalid command definition";return e.name=e.name.toUpperCase(),e}function w(a,b){return(a.which||a.keyCode)===b}function x(){var a=C.width(),b=C.text(),c=b.length-b.trim().length;return a+=c*y()}function y(){if(!C._spaceWidth){var b=a('<span style="visibility: hidden">| |</span>').appendTo(C),c=a('<span style="visibility: hidden">||</span>').appendTo(C);C._spaceWidth=b.innerWidth()-c.innerWidth(),b.remove(),c.remove()}return C._spaceWidth}function z(a,b,c){var d=c>=0;for(c=Math.abs(c);a.length<c;)a=d?a+b:b+a;return a}var A,B,C,D,E,F,G,H="1.0.3-alpha",I={},J=!1,K='<div class="cmdr" style="display: none"><div class="output"></div><div class="input"><span class="prefix"></span><textarea class="prompt" spellcheck="false" row="1" /></div></div>',L=[],M=[],N=-1,O={autoOpen:!1,openKey:96,closeKey:27,echo:!0,promptPrefix:"> "},P={activate:b,deactivate:c,reactivate:d,open:f,close:g,read:h,readLine:i,write:j,writeLine:k,clear:l,execute:m,setup:n,commands:I,config:O,version:H};return P.setup("VER",function(){P.writeLine("cmdrjs (version "+P.version+")")},{description:"Displays the cmdrjs version"}),P.setup("HELP",function(){P.writeLine("The following commands are available:"),P.writeLine();for(var a in I){var b=I[a];P.write(z(a," ",10)),P.writeLine(b.description)}P.writeLine()},{description:"Lists the available commands"}),P.setup("ECHO",function(a){var b=a.toUpperCase();"ON"===b?P.config.echo=!0:"OFF"===b?P.config.echo=!1:P.writeLine(a)},{parse:!1,description:"Displays provided text or toggles command echoing"}),P.setup("CLS",function(){P.clear()},{description:"Clears the command prompt"}),P.setup("EXIT",function(){P.close()},{description:"Closes the command prompt"}),P})}("function"==typeof define&&define.amd?define:function(a,b){"undefined"!=typeof module&&module.exports?module.exports=b(require("jquery")):window.cmdr=b(jQuery)});