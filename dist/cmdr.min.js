/* cmdrjs | version 2.0.0-beta.3 | license MIT | (c) 2019 John Cruikshank | https://github.com/cmdrjs/cmdrjs */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).cmdr=e()}}(function(){return function o(a,u,l){function s(t,e){if(!u[t]){if(!a[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(c)return c(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var i=u[t]={exports:{}};a[t][0].call(i.exports,function(e){return s(a[t][1][e]||e)},i,i.exports,o,a,u,l)}return u[t].exports}for(var c="function"==typeof require&&require,e=0;e<l.length;e++)s(l[e]);return s}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t=a();if(t&&t.has(e))return t.get(e);var n={};if(null!=e){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}}n.default=e,t&&t.set(e,n);return n}(e("./utils.js"));function a(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return a=function(){return e},e}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lookups=[],this._context=null,this._index=-1,this._values=[],this._predefineLookups()}return function(e,t,n){t&&i(e.prototype,t),n&&i(e,n)}(e,[{key:"activate",value:function(e){}},{key:"deactivate",value:function(e){}},{key:"getNextValue",value:function(n,r){var i=this;return r!==this._context&&(this._context=r,this._index=-1,this._values=this._lookupValues(r)),Promise.all([this._values]).then(function(e){var t=(e=e[0]).filter(function(e){return""===r.incompleteValue||e.toLowerCase().slice(0,r.incompleteValue.toLowerCase().length)===r.incompleteValue.toLowerCase()});return 0===t.length?null:(i._index>=t.length&&(i._index=-1),n&&i._index<t.length-1?i._index++:n&&i._index>=t.length-1?i._index=0:!n&&0<i._index?i._index--:!n&&i._index<=0&&(i._index=t.length-1),t[i._index])})}},{key:"_lookupValues",value:function(e){var t,n=!0,r=!1,i=void 0;try{for(var o,a=this.lookups[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var u=o.value,l=(t=u,Array.isArray(t)?t:"function"==typeof t?t(e):null);if(l)return l}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return[]}},{key:"_predefineLookups",value:function(){this.lookups.push(function(e){if(""!==e.precursorValue.trim())return null;var t=e.terminal.shell.getCommands();return r.arrayFrom(t,function(e){return e.name})})}}]),e}();n.default=o},{"./utils.js":11}],2:[function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._isCancelRequested=!1,this._cancelHandlers=[]}return function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}(e,[{key:"cancel",value:function(){if(!this._isCancelRequested){var e=!0,t=!1,n=void 0;try{for(var r,i=this._cancelHandlers[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;try{o(this)}catch(e){console.error(e)}}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}this._isCancelRequested=!0}},{key:"uncancel",value:function(){this._isCancelRequested=!1}},{key:"onCancel",value:function(e){if(this._isCancelRequested)try{e(this)}catch(e){console.error(e)}this._cancelHandlers.push(e)}},{key:"offCancel",value:function(e){var t=this._cancelHandlers.indexOf(e);-1<t&&this._cancelHandlers.splice(t,1)}},{key:"isCancelRequested",get:function(){return this._isCancelRequested}}]),e}();n.default=i},{}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"Terminal",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(n,"OverlayTerminal",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(n,"ShellBase",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(n,"Shell",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(n,"HistoryProvider",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(n,"AutocompleteProvider",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(n,"Command",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(n,"Plugin",{enumerable:!0,get:function(){return c.default}}),n.version=void 0;var r=f(e("./terminal.js")),i=f(e("./overlay-terminal.js")),o=f(e("./shell-base.js")),a=f(e("./shell.js")),u=f(e("./history-provider.js")),l=f(e("./autocomplete-provider.js")),s=f(e("./command.js")),c=f(e("./plugin.js"));function f(e){return e&&e.__esModule?e:{default:e}}n.version="2.0.0"},{"./autocomplete-provider.js":1,"./command.js":4,"./history-provider.js":5,"./overlay-terminal.js":6,"./plugin.js":7,"./shell-base.js":8,"./shell.js":9,"./terminal.js":10}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t=a();if(t&&t.has(e))return t.get(e);var n={};if(null!=e){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}}n.default=e,t&&t.set(e,n);return n}(e("./utils.js"));function a(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return a=function(){return e},e}function i(e,t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),"string"!=typeof e&&(n=t,t=e,e=null),"function"!=typeof t&&(n=t,t=null),this.name=e,this.main=t,this.description=null,this.usage=null,this.available=!0,this.help=function(){this.definition.description&&this.terminal.writeLine(this.definition.description),this.definition.description&&this.definition.usage&&this.terminal.writeLine(),this.definition.usage&&this.terminal.writeLine(this.definition.usage)},r.extend(this,n),this.main=this.main||function(){},"string"!=typeof this.name)throw'"name" must be a string.';if("function"!=typeof this.main)throw'"main" must be a function.';this.name=this.name.toUpperCase(),this.usage||(this.usage=this.name)}n.default=i},{"./utils.js":11}],5:[function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.values=[],this.index=-1,this._preexecuteHandler=function(e){t.values.unshift(e),t.index=-1}}return function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}(e,[{key:"activate",value:function(e){e.on("preexecute",this._preexecuteHandler)}},{key:"deactivate",value:function(e){e.off("preexecute",this._preexecuteHandler)}},{key:"getNextValue",value:function(e){return e&&0<this.index?(this.index--,this.values[this.index]):!e&&this.values.length>this.index+1?(this.index++,this.values[this.index]):null}}]),e}();n.default=i},{}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r,i=function(e){if(e&&e.__esModule)return e;var t=a();if(t&&t.has(e))return t.get(e);var n={};if(null!=e){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}}n.default=e,t&&t.set(e,n);return n}(e("./utils.js")),o=(r=e("./terminal.js"))&&r.__esModule?r:{default:r};function a(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return a=function(){return e},e}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function c(e,t,n){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p={autoOpen:!1,openKey:192,closeKey:27},h=function(){function r(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var n=i.createElement('<div style="display: none" class="cmdr-overlay"></div>');return document.body.appendChild(n),e=i.extend({},p,e),(t=s(this,f(r).call(this,n,e)))._overlayNode=n,t._documentEventHandler=null,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(r,o["default"]),function(e,t,n){t&&l(e.prototype,t),n&&l(e,n)}(r,[{key:"init",value:function(){var t=this;this.initialized||(this._documentEventHandler=function(e){t.isOpen||-1!==["INPUT","TEXTAREA","SELECT"].indexOf(e.target.tagName)||e.target.isContentEditable||e.keyCode!=t.options.openKey?t.isOpen&&e.keyCode==t.options.closeKey&&t.close():(e.preventDefault(),t.open())},document.addEventListener("keydown",this._documentEventHandler),c(f(r.prototype),"init",this).call(this),this.options.autoOpen&&this.open())}},{key:"dispose",value:function(){this.initialized&&(c(f(r.prototype),"dispose",this).call(this),document.removeEventListener("keydown",this._documentEventHandler),document.body.removeChild(this._overlayNode))}},{key:"open",value:function(){var e=this;this._overlayNode.style.display="",document.body.style.overflow="hidden",setTimeout(function(){e._fixPromptIndent(),e.focus()},0)}},{key:"close",value:function(){this._overlayNode.style.display="none",document.body.style.overflow="",this.blur()}},{key:"isOpen",get:function(){return"none"!==this._overlayNode.style.display}}]),r}();n.default=h},{"./terminal.js":10,"./utils.js":11}],7:[function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}(e,[{key:"activate",value:function(e){}},{key:"deactivate",value:function(e){}}]),e}();n.default=i},{}],8:[function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}(e,[{key:"executeCommand",value:function(e,t,n){}},{key:"getCommands",value:function(e){return[]}},{key:"parseCommandLine",value:function(e,t){var n=/[^\s"]+|"([^"]*)"/gi,r=null,i=null,o=[],a=null;do{if(null!==(a=n.exec(e)))if(t){var u=a[1]?a[1]:a[0];0===a.index?(r=u,i=e.substr(u.length+(a[1]?3:1))):o.push(u)}else o.push(a[0])}while(null!==a);return t?{name:r,argString:i,args:o}:o}}]),e}();n.default=i},{}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=function(e){if(e&&e.__esModule)return e;var t=a();if(t&&t.has(e))return t.get(e);var n={};if(null!=e){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}}n.default=e,t&&t.set(e,n);return n}(e("./utils.js")),r=o(e("./shell-base.js")),i=o(e("./command.js"));function o(e){return e&&e.__esModule?e:{default:e}}function a(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return a=function(){return e},e}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t,n){return(l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&p(i,n.prototype),i}).apply(null,arguments)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h={contextExtensions:{},builtInCommands:["HELP","ECHO","CLS"],allowAbbreviations:!0},v=function(){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=f(this,d(n).call(this))).options=s.extend({},h,e),t.commands={},t._addBuiltInCommands(),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(n,r["default"]),function(e,t,n){t&&c(e.prototype,t),n&&c(e,n)}(n,[{key:"executeCommand",value:function(e,t,n){var r=this.parseCommandLine(t,!0),i=this.getCommands(r.name);if(!i||i.length<1)return e.writeLine("Invalid command","error"),!1;if(1<i.length){e.writeLine("Ambiguous command","error"),e.writeLine();for(var o=0;o<i.length;o++)e.writePad(i[o].name,10),e.writeLine(i[o].description);return e.writeLine(),!1}var a=i[0],u={terminal:e,commandLine:t,command:a,parsed:r,defer:s.defer,cancelToken:n};s.extend(u,this.options.contextExtensions);var l=r.args;if(a.help&&0<l.length&&"/?"===l[l.length-1]){if("string"==typeof a.help)return e.writeLine(a.help),!1;if("function"==typeof a.help)return a.help.apply(u,l)}return a.main.apply(u,l)}},{key:"getCommands",value:function(e){var t=[];if(e){e=e.toUpperCase();var n=this.commands[e];if(n)return n.available?[n]:null;if(this.options.allowAbbreviations)for(var r in this.commands)0===r.indexOf(e,0)&&s.unwrap(this.commands[r].available)&&t.push(this.commands[r])}else for(var i in this.commands)t.push(this.commands[i]);return t}},{key:"addCommand",value:function(e){e instanceof i.default||(e=l(i.default,Array.prototype.slice.call(arguments))),this.commands[e.name]=e}},{key:"_addBuiltInCommands",value:function(){var n=this;-1<this.options.builtInCommands.indexOf("HELP")&&this.addCommand({name:"HELP",main:function(){this.terminal.writeLine("The following commands are available:"),this.terminal.writeLine();var e=Object.keys(n.commands).map(function(e){return n.commands[e]}).filter(function(e){return e.available}),t=e.slice().sort(function(e,t){return t.name.length-e.name.length})[0].name.length;this.terminal.writeTable(e,["name:"+(t+2).toString(),"description:40"]),this.terminal.writeLine(),this.terminal.writeLine('* Pass "/?" into any command to display help for that command.'),n.options.allowAbbreviations&&this.terminal.writeLine('* Command abbreviations are allowed (e.g. "H" for "HELP").')},description:"Lists the available commands."}),-1<this.options.builtInCommands.indexOf("ECHO")&&this.addCommand({name:"ECHO",main:function(){var e=this.argString.toUpperCase();"ON"===e?this.terminal.echo=!0:"OFF"===e?this.terminal.echo=!1:this.argString?this.terminal.writeLine(this.argString):this.terminal.writeLine("ECHO is "+(this.terminal.echo?"on.":"off."))},description:"Displays messages, or toggles command echoing.",usage:"ECHO [ON | OFF]\nECHO [message]\n\nType ECHO without parameters to display the current echo setting."}),-1<this.options.builtInCommands.indexOf("CLS")&&this.addCommand({name:"CLS",main:function(){this.terminal.clear()},description:"Clears the command prompt."})}}]),n}();n.default=v},{"./command.js":4,"./shell-base.js":8,"./utils.js":11}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var c=function(e){if(e&&e.__esModule)return e;var t=a();if(t&&t.has(e))return t.get(e);var n={};if(null!=e){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=r?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(n,i,o):n[i]=e[i]}}n.default=e,t&&t.set(e,n);return n}(e("./utils.js")),u=r(e("./history-provider.js")),l=r(e("./autocomplete-provider.js")),s=r(e("./shell.js")),f=r(e("./cancel-token.js"));function r(e){return e&&e.__esModule?e:{default:e}}function a(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return a=function(){return e},e}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o={echo:!0,promptPrefix:">",template:'<div class="cmdr-terminal"><div class="output"></div><div class="input"><span class="prefix"></span><textarea class="prompt" spellcheck="false"></textarea></div></div>',theme:"cmd",autoScroll:!0,historyProvider:null,autocompleteProvider:null,shell:null,plugins:[]},p=function(){function n(e,t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),!e||!c.isElement(e))throw'"containerNode" must be an HTMLElement.';this._options=c.extend({},o,t),this._containerNode=e,this._terminalNode=null,this._inputNode=null,this._prefixNode=null,this._promptNode=null,this._outputNode=null,this._outputLineNode=null,this._echo=!0,this._current=null,this._queue=[],this._promptPrefix=null,this._isInputInline=!1,this._autocompleteContext=null,this._eventHandlers={},this._isInitialized=!1,this._historyProvider=null,this._autocompleteProvider=null,this._shell=null,this._plugins=[],this.init()}return function(e,t,n){t&&i(e.prototype,t),n&&i(e,n)}(n,[{key:"init",value:function(){var n=this;if(!this._isInitialized){this._terminalNode=c.createElement(this._options.template),this._terminalNode.className+=" cmdr-terminal--"+this._options.theme,this._containerNode.appendChild(this._terminalNode),this._outputNode=this._terminalNode.querySelector(".output"),this._inputNode=this._terminalNode.querySelector(".input"),this._prefixNode=this._terminalNode.querySelector(".prefix"),this._promptNode=this._terminalNode.querySelector(".prompt"),this._promptNode.addEventListener("keydown",function(e){if(n._current){if(e.ctrlKey&&67===e.keyCode?n.cancel():n._current.readLine&&13===e.keyCode&&n._current.readLine.resolve(n._promptNode.value),!n._current.read&&!n._current.readLine)return e.preventDefault(),!1}else switch(9===e.keyCode||e.shiftKey||n._autocompleteReset(),e.keyCode){case 13:var t=n._promptNode.value;return t&&n.execute(t),e.preventDefault(),!1;case 38:return n._historyCycle(!1),e.preventDefault(),!1;case 40:return n._historyCycle(!0),e.preventDefault(),!1;case 9:return n._autocompleteCycle(!e.shiftKey),e.preventDefault(),!1}return!0}),this._promptNode.addEventListener("keypress",function(e){return!n._current||!n._current.read||(0!==e.charCode&&n._current.read.resolve(String.fromCharCode(e.charCode)),e.preventDefault(),!1)}),this._promptNode.addEventListener("input",function(e){n._fixPromptHeight()}),this._terminalNode.addEventListener("click",function(e){e.target===n._inputNode||n._inputNode.contains(e.target)||e.target===n._outputNode||n._outputNode.contains(e.target)||n._promptNode.focus()}),this._promptPrefix=this._options.promptPrefix,this._echo=this._options.echo,this._shell=this.options.shell||new s.default,this._historyProvider=this._options.historyProvider||new u.default,this._historyProvider.activate(this),this._autocompleteProvider=this._options.autocompleteProvider||new l.default,this._autocompleteProvider.activate(this);var e=!0,t=!1,r=void 0;try{for(var i,o=this._options.plugins[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;this._plugins.push(a),a.activate(this)}}catch(e){t=!0,r=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw r}}this._activateInput(),this._isInitialized=!0}}},{key:"dispose",value:function(){if(this._isInitialized){this._containerNode.removeChild(this._terminalNode),this._terminalNode=null,this._outputNode=null,this._inputNode=null,this._prefixNode=null,this._promptNode=null,this._echo=!0,this._current=null,this._queue=[],this._promptPrefix=null,this._isInputInline=!1,this._autocompleteContext=null,this._eventHandlers={},this._shell=null,this._historyProvider&&(this._historyProvider.deactivate(this),this._historyProvider=null),this._autocompleteProvider&&(this._autocompleteProvider.deactivate(this),this._autocompleteProvider=null);var e=!0,t=!1,n=void 0;try{for(var r,i=this._plugins[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){r.value.deactivate(this)}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}this._plugins=[],this._isInitialized=!1}}},{key:"reset",value:function(){this.dispose(),this.init()}},{key:"read",value:function(n,r){var i=this;if(this._current){this._activateInput(!0);var o=c.defer();return this._current.read=c.defer(),this._current.read.then(function(e){i._current.read=null,i._deactivateInput(),r||(i._prefixNode.textContent+=e,i._promptNode.value="",i._fixPromptHeight());var t=!1;try{t=n(e,i._current)}catch(e){i.writeLine("Unhandled exception","error"),i.writeLine(e,"error"),o.reject(e)}!0===t?i.read(n).then(o.resolve,o.reject):(i._flushInput(),o.resolve()),o.resolve()}),this._current.read.intercept=r,o}}},{key:"readLine",value:function(n){var r=this;if(this._current){this._activateInput(!0);var i=c.defer();return this._current.readLine=c.defer(),this._current.readLine.then(function(e){r._current.readLine=null,r._promptNode.value=e,r._fixPromptHeight(),r._deactivateInput(),r._flushInput();var t=!1;try{t=n(e,r._current)}catch(e){r.writeLine("Unhandled exception","error"),r.writeLine(e,"error"),i.reject(e)}!0===t?r.readLine(n).then(i.resolve,i.reject):i.resolve()}),i}}},{key:"write",value:function(e,t,n){e=e||"",e=n?e:c.encodeHtml(e);var r=c.createElement("<span>".concat(e,"</span>"));"string"==typeof t?r.className=t:r.style=t,this._outputLineNode||(this._outputLineNode=c.createElement("<div></div>"),this._outputNode.appendChild(this._outputLineNode)),this._outputLineNode.appendChild(r),this._options.autoScroll&&(this._terminalNode.scrollTop=this._terminalNode.scrollHeight)}},{key:"writeLine",value:function(e,t,n){e=(e||"")+"\n",this.write(e,t,n),this._outputLineNode=null}},{key:"writePad",value:function(e,t,n,r,i){var o=2<arguments.length&&void 0!==n?n:" ",a=3<arguments.length&&void 0!==r?r:null,u=4<arguments.length&&void 0!==i&&i;this.write(c.pad(e,t,o),a,u)}},{key:"writeTable",value:function(e,t,n,r,i){var o=this;t=t.map(function(e){var t=e.split(":");return{name:t[0],padding:1<t.length?t[1]:10,header:2<t.length?t[2]:t[0]}});function a(e,t){e=e||"","*"===t?o.write(e,r,i):o.writePad(e,parseInt(t,10)," ",r,i)}if(n){var u=!0,l=!1,s=void 0;try{for(var c,f=t[Symbol.iterator]();!(u=(c=f.next()).done);u=!0){var d=c.value;a(d.header,d.padding)}}catch(e){l=!0,s=e}finally{try{u||null==f.return||f.return()}finally{if(l)throw s}}this.writeLine();var p=!0,h=!1,v=void 0;try{for(var m,y=t[Symbol.iterator]();!(p=(m=y.next()).done);p=!0){var _=m.value;a(Array(_.header.length+1).join("-"),_.padding)}}catch(e){h=!0,v=e}finally{try{p||null==y.return||y.return()}finally{if(h)throw v}}this.writeLine()}var b=!0,g=!1,w=void 0;try{for(var x,O=e[Symbol.iterator]();!(b=(x=O.next()).done);b=!0){var P=x.value,j=!0,N=!1,C=void 0;try{for(var k,L=t[Symbol.iterator]();!(j=(k=L.next()).done);j=!0){var E=k.value;a(P[E.name]?P[E.name].toString():"",E.padding)}}catch(e){N=!0,C=e}finally{try{j||null==L.return||L.return()}finally{if(N)throw C}}this.writeLine()}}catch(e){g=!0,w=e}finally{try{b||null==O.return||O.return()}finally{if(g)throw w}}}},{key:"clear",value:function(){this._outputNode.innerHTML=""}},{key:"clearLine",value:function(){this._outputNode.lastChild&&this._outputNode.removeChild(this._outputNode.lastChild)}},{key:"focus",value:function(){this._promptNode.focus()}},{key:"blur",value:function(){c.blur(this._promptNode)}},{key:"on",value:function(e,t){this._eventHandlers[e]||(this._eventHandlers[e]=[]),this._eventHandlers[e].push(t)}},{key:"off",value:function(e,t){if(this._eventHandlers[e]){var n=this._eventHandlers[e].indexOf(t);-1<n&&this._eventHandlers[e].splice(n,1)}}},{key:"execute",value:function(t){var n,r=this;if("object"===d(t))n=t.deferred,t=t.text;else{if(!("string"==typeof t&&0<t.length))return(n=c.defer()).reject("Invalid command"),n;n=c.defer();for(var e=arguments.length,i=new Array(1<e?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];i&&(t=this._buildCommand(t,i))}if(this._current)return this._queue.push({deferred:n,text:t,executeOnly:!0}),n;var a=t;t=t.trim(),this._trigger("preexecute",t),this._promptNode.value=a,this._fixPromptHeight(),this._flushInput(!this._echo),this._deactivateInput();var u=new f.default;this._current={commandLine:t,cancelToken:u};function l(){setTimeout(function(){r._current=null,0<r._outputNode.children.length&&r.writeLine(),r._activateInput(),0<r._queue.length&&r.execute(r._queue.shift())},0)}var s;try{s=this._shell.executeCommand(this,t,u)}catch(e){return this.writeLine("Unhandled exception","error"),this.writeLine(e,"error"),n.reject("Unhandled exception"),l(),n}return Promise.all([s]).then(function(e){r._trigger("execute",{commandLine:t});try{n.resolve(e[0])}finally{l()}},function(e){r._trigger("execute",{commandLine:t,error:e});try{n.reject(e)}finally{l()}}),n}},{key:"cancel",value:function(){this._current&&this._current.cancelToken.cancel()}},{key:"_buildCommand",value:function(e,t){var n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var u=o.value;"string"==typeof u&&-1<u.indexOf(" ")?e+=' "'.concat(u,'"'):e+=" "+u.toString()}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return e}},{key:"_activateInput",value:function(e){e?(this._outputLineNode&&(this._prefixNode.innerHTML=this._outputLineNode.innerHTML,this._outputNode.removeChild(this._outputLineNode),this._outputLineNode=null),this._isInputInline=!0):(this._prefixNode.innerHTML=this._promptPrefix,this._isInputInline=!1),this._inputNode.style.display="",this._promptNode.removeAttribute("disabled"),this._fixPromptIndent(),this._promptNode.focus(),this._terminalNode.scrollTop=this._terminalNode.scrollHeight}},{key:"_deactivateInput",value:function(){this._promptNode.style.textIndent="",this._promptNode.setAttribute("disabled","disabled")}},{key:"_flushInput",value:function(e){if(!e){var t="".concat(this._prefixNode.innerHTML).concat(this._promptNode.value);if(t){var n=c.createElement("<div>".concat(t,"</div>"));this._outputNode.appendChild(n)}}this._prefixNode.textContent="",this._promptNode.value="",this._fixPromptHeight()}},{key:"_trigger",value:function(e,t){if(this._eventHandlers[e]){var n=!0,r=!1,i=void 0;try{for(var o,a=this._eventHandlers[e][Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var u=o.value;try{u(t)}catch(e){console.error(e)}}}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}}}},{key:"_historyCycle",value:function(e){var n=this;Promise.all([this._historyProvider.getNextValue(e)]).then(function(e){var t=e[0];t&&(n._promptNode.value=t,n._fixPromptHeight(),c.cursorToEnd(n._promptNode),c.dispatchEvent(n._promptNode,"change",!0,!1))})}},{key:"_autocompleteCycle",value:function(e){var n=this;if(!this._autocompleteContext){var t=this._promptNode.value;t=t.replace(/\s$/," ");var r=c.getCursorPosition(this._promptNode),i=t.lastIndexOf(" ",r)+1;i=-1!==i?i:0;var o=t.indexOf(" ",i);o=-1!==o?o:t.length;var a=t.substring(i,o),u=t.substring(0,i),l=this.shell.parseCommandLine(u);this._autocompleteContext={terminal:this,incompleteValue:a,precursorValue:u,parsed:l}}Promise.all([this._autocompleteProvider.getNextValue(e,this._autocompleteContext)]).then(function(e){var t=e[0];t&&(n._promptNode.value=n._autocompleteContext.precursorValue+t,n._fixPromptHeight(),c.cursorToEnd(n._promptNode),c.dispatchEvent(n._promptNode,"change",!0,!1))})}},{key:"_autocompleteReset",value:function(){this._autocompleteContext=null}},{key:"_fixPromptIndent",value:function(){var e=this._prefixNode.getBoundingClientRect().width,t=this._prefixNode.textContent,n=t.length-t.trim().length;if(!this._prefixNode._spaceWidth){var r=c.createElement('<span style="visibility: hidden">| |</span>');this._prefixNode.appendChild(r);var i=c.createElement('<span style="visibility: hidden">||</span>');this._prefixNode.appendChild(i),this._prefixNode._spaceWidth=r.offsetWidth-i.offsetWidth,this._prefixNode.removeChild(r),this._prefixNode.removeChild(i)}e+=n*this._prefixNode._spaceWidth,this._promptNode.style.textIndent=e+"px"}},{key:"_fixPromptHeight",value:function(){this._promptNode.style.height="auto",this._promptNode.style.height=this._promptNode.scrollHeight+"px"}},{key:"isInitialized",get:function(){return this._isInitialized}},{key:"options",get:function(){return this._options}},{key:"promptPrefix",get:function(){return this._promptPrefix},set:function(e){this._promptPrefix=e,this._isInputInline||(this._prefixNode.textContent=e,this._fixPromptIndent())}},{key:"echo",get:function(){return this._echo},set:function(e){this._echo=e}},{key:"shell",get:function(){return this._shell}},{key:"historyProvider",get:function(){return this._historyProvider}},{key:"autocompleteProvider",get:function(){return this._autocompleteProvider}},{key:"plugins",get:function(){return Object.freeze(this._plugins)}}]),n}();n.default=p},{"./autocomplete-provider.js":1,"./cancel-token.js":2,"./history-provider.js":5,"./shell.js":9,"./utils.js":11}],11:[function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.extend=function(e){e=e||{};for(var t=1;t<arguments.length;t++)if(arguments[t])for(var n in arguments[t])arguments[t].hasOwnProperty(n)&&(e[n]=arguments[t][n]);return e},n.arrayFrom=function(e){function t(e){return"function"==typeof e||"[object Function]"===n.call(e)}var n=Object.prototype.toString,r=Math.pow(2,53)-1,i=Object(e);if(null==e)throw new TypeError("arrayFrom requires an array-like object - not null or undefined");var o,a=1<arguments.length?arguments[1]:void 0;if(void 0!==a){if(!t(a))throw new TypeError("arrayFrom: when provided, the second argument must be a function");2<arguments.length&&(o=arguments[2])}var u,l=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(0<t?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),r)}(i.length),s=t(this)?Object(new this(l)):new Array(l),c=0;for(;c<l;)u=i[c],s[c]=a?void 0===o?a(u,c):a.call(o,u,c):u,c+=1;return s.length=l,s},n.pad=function(e,t,n){var r=0<=t;t=Math.abs(t);for(;e.length<t;)e=r?e+n:n+e;return e},n.encodeHtml=function(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML},n.unwrap=function(e){return"function"==typeof e?e():e},n.defer=function(){return new function(){var n=this;this.promise=new Promise(function(e,t){n.resolve=e,n.reject=t}),this.then=this.promise.then.bind(this.promise),this.catch=this.promise.catch.bind(this.promise)}},n.isElement=function(e){return"object"===("undefined"==typeof HTMLElement?"undefined":r(HTMLElement))?e instanceof HTMLElement:e&&"object"===r(e)&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName},n.createElement=function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild},n.dispatchEvent=function(e,t,n,r){var i=document.createEvent("HTMLEvents");i.initEvent(t,n,r),e.dispatchEvent(i)},n.blur=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;if(e&&e!==document.activeElement)return;var t=document.createElement("input");document.body.appendChild(t),t.focus(),document.body.removeChild(t)},n.cursorToEnd=function(e){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)},n.getCursorPosition=function(e){var t,n=0,r=e.ownerDocument||e.document,i=r.defaultView||r.parentWindow;if(void 0!==i.getSelection){if(0<(t=i.getSelection()).rangeCount){var o=i.getSelection().getRangeAt(0),a=o.cloneRange();a.selectNodeContents(e),a.setEnd(o.endContainer,o.endOffset),n=a.toString().length}}else if((t=r.selection)&&"Control"!=t.type){var u=t.createRange(),l=r.body.createTextRange();l.moveToElementText(e),l.setEndPoint("EndToEnd",u),n=l.text.length}return n}},{}]},{},[3])(3)});