!function(a){a(["jquery"],function(a){function b(){L||(C=a(M).appendTo("body"),D=a(".input",C),E=a(".prefix",C),F=a(".prompt",C),G=a(".output",C),a(document).on("keydown.cmdr",function(b){e()||a(b.target).is("input, textarea, select, [contenteditable]")||b.keyCode!=Q.openKey?e()&&b.keyCode==Q.closeKey&&g():(b.preventDefault(),f())}),F.on("keydown",function(a){if(I){if(I.readLine&&13===a.keyCode)return I.readLine.resolve(A()),!1}else switch(a.keyCode){case 13:var b=A();return b&&m(b),a.preventDefault(),!1;case 38:return s(),a.preventDefault(),!1;case 40:return t(),a.preventDefault(),!1;case 9:return a.preventDefault(),!1}return!0}),F.on("keypress",function(a){if(I&&I.read){if(0===a.charCode)return!1;if(I.read["char"]=String.fromCharCode(a.charCode),I.read.capture)return!1}return!0}),F.on("keyup",function(){I&&I.read&&I.read["char"]&&I.read.resolve(I.read["char"])}),F.on("paste",function(){setTimeout(function(){var a=A(),b=a.split(/\r\n|\r|\n/g),c=b.length;if(c>1){for(var d=1;c>d;d++)b[d].length>0&&N.push(b[d]);I&&I.readLine?I.readLine.resolve(b[0]):I&&I.read?I.read.resolve(b[0][0]):m(b[0])}},0)}),R.promptIndentPadding&&F.on("input",function(){F.css(B())}),C.on("click",function(b){a(b.target).is(".input *, .output *")||F.focus()}),o(),L=!0,Q.autoOpen&&f())}function c(){L&&(C.remove(),C=null,D=null,E=null,F=null,G=null,a(document).off("keydown.cmdr"),L=!1)}function d(){L&&c(),b()}function e(){return C.is(":visible")}function f(){L&&(C.show(),setTimeout(function(){F.css(B()).focus()},0))}function g(){L&&(C.hide(),F.blur())}function h(b,c){L&&I&&(o(!0),I.read=a.Deferred().always(function(a){I.read=null,c||A(a),p(),b.call(I,a)===!0?h(b,c):q()}),I.read.capture=c,N.length>0&&I.read.resolve(N.shift()[0]))}function i(b){L&&I&&(o(!0),I.readLine=a.Deferred().always(function(a){I.readLine=null,A(a),p(),q(),b.call(I,a)===!0&&i(b)}),N.length>0&&I.readLine.resolve(N.shift()))}function j(b,c){if(L){b=b||"";var d=a("<span/>").addClass(c).text(b);H||(H=a("<div/>").appendTo(G)),H.append(d)}}function k(a,b){L&&(a=(a||"")+"\n",j(a,b),H=null)}function l(){L&&G.html("")}function m(b){if(L){if(I)return void N.push(b);if("string"!=typeof b||0===b.length)throw"Invalid command";A(b),q(!Q.echo),r(b),p(),b=b.trim();var c=u(b),d=K[c.name.toUpperCase()];if(!d||!z(d.available))return k("Invalid command","error"),void o();I={command:b,definition:d};var e=c.args;d.parse||(e=[c.arg]);var f=d.callback.apply(I,e);a.when(f).always(function(){setTimeout(function(){I=null,o(),N.length>0&&m(N.shift())},0)})}}function n(a,b,c){for(var d=v(a,b,c),e=0,f=d.names.length;f>e;e++)K[d.names[e].toUpperCase()]=d}function o(a){a?H&&(E.text(H.text()),H.remove(),H=null):E.text(Q.promptPrefix),D.show(),setTimeout(function(){F.prop("disabled",!1).css(B()).focus(),C.animate({scrollTop:C[0].scrollHeight},1e3)},0)}function p(){F.prop("disabled",!0),D.hide()}function q(a){a||(j(E.text()),k(A())),E.text(""),A("")}function r(a){O.unshift(a),P=-1}function s(){O.length>P+1&&(P++,A(O[P]),F.change())}function t(){P>0&&(P--,A(O[P]),F.change())}function u(a){var b=/[^\s"]+|"([^"]*)"/gi,c=null,d=null,e=[],f=null;do if(f=b.exec(a),null!==f){var g=f[1]?f[1]:f[0];0===f.index?(c=g,d=a.substr(g.length+(f[1]?3:1))):e.push(g)}while(null!==f);return{name:c,arg:d,args:e}}function v(b,c,d){"string"==typeof b||a.isArray(b)||(d=c,c=b,b=null),"function"!=typeof c&&(d=c,c=null),"string"==typeof b?b=[b]:a.isArray(b)&&(b=a.grep(b,function(a){return"string"==typeof a}));var e={names:b,callback:c,parse:!0,available:!0};if(a.extend(e,d),!a.isArray(e.names)||0===e.names.length||"function"!=typeof e.callback)throw"Invalid command definition";return e}function w(){var a=E.width(),b=E.text(),c=b.length-b.trim().length;return a+=c*x()}function x(){if(!E._spaceWidth){var b=a('<span style="visibility: hidden">| |</span>').appendTo(E),c=a('<span style="visibility: hidden">||</span>').appendTo(E);E._spaceWidth=b.innerWidth()-c.innerWidth(),b.remove(),c.remove()}return E._spaceWidth}function y(a,b,c){var d=c>=0;for(c=Math.abs(c);a.length<c;)a=d?a+b:b+a;return a}function z(a){return"function"==typeof a?a():a}function A(a){return"undefined"==typeof a?F.text():void F.text(a)}function B(){return R.promptIndentPadding?A()?{"text-indent":w()+"px","padding-left":""}:{"padding-left":w()+"px","text-indent":""}:{"text-indent":w()+"px"}}var C,D,E,F,G,H,I,J="1.0.3-alpha",K={},L=!1,M='<div class="cmdr" style="display: none"><div class="output"></div><div class="input"><span class="prefix"></span><div class="prompt" spellcheck="false" contenteditable="true" /></div></div>',N=[],O=[],P=-1,Q={autoOpen:!1,openKey:192,closeKey:27,echo:!0,promptPrefix:"> "},R={promptIndentPadding:"undefined"!=typeof InstallTrigger},S={activate:b,deactivate:c,reactivate:d,open:f,close:g,read:h,readLine:i,write:j,writeLine:k,clear:l,execute:m,setup:n,commands:K,config:Q,version:J};return S.setup(["HELP","?","/?"],function(){S.writeLine("The following commands are available:"),S.writeLine();for(var a in K){var b=K[a];z(b.available)&&(S.write(y(a," ",10)),S.writeLine(b.description))}S.writeLine()},{description:"Lists the available commands"}),S.setup(["VERSION","VER"],function(){S.writeLine("cmdrjs (version "+S.version+")")},{description:"Displays the cmdrjs version"}),S.setup("ECHO",function(a){var b=a.toUpperCase();"ON"===b?S.config.echo=!0:"OFF"===b?S.config.echo=!1:S.writeLine(a)},{parse:!1,description:"Displays provided text or toggles command echoing"}),S.setup(["CLEAR","CLS"],function(){S.clear()},{description:"Clears the command prompt"}),S.setup(["QUIT","EXIT"],function(){S.close()},{description:"Closes the command prompt"}),S})}("function"==typeof define&&define.amd?define:function(a,b){"undefined"!=typeof module&&module.exports?module.exports=b(require("jquery")):window.cmdr=b(jQuery)});